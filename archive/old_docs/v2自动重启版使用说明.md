# ERA5ä¸‹è½½å™¨ v2.1 - æ™ºèƒ½è‡ªåŠ¨é‡å¯ç‰ˆ ä½¿ç”¨è¯´æ˜

## ğŸ¯ ç‰ˆæœ¬è¯´æ˜

åŸºäº **v2_fixed** ç‰ˆæœ¬ï¼Œæ–°å¢æ™ºèƒ½è‡ªåŠ¨é‡å¯åŠŸèƒ½ï¼Œè§£å†³é•¿æ—¶é—´ä¸‹è½½é€Ÿåº¦ä¸‹é™çš„é—®é¢˜ã€‚

---

## âœ¨ æ–°å¢åŠŸèƒ½

### 1. æ™ºèƒ½é€Ÿåº¦ç›‘æ§
- å®æ—¶ç›‘æ§ä¸‹è½½é€Ÿåº¦
- è‡ªåŠ¨æ£€æµ‹é€Ÿåº¦æŒç»­ä¸‹é™
- æ— éœ€å¤–éƒ¨ä¾èµ–ï¼Œé›†æˆåœ¨ç¨‹åºå†…éƒ¨

### 2. è‡ªåŠ¨é‡å¯æœºåˆ¶
å½“é€Ÿåº¦æŒç»­ä½äºé˜ˆå€¼ä¸€å®šæ—¶é—´åï¼š
```
é€Ÿåº¦ < 500 KB/s ä¸” æŒç»­ 30ç§’
    â†“
è‡ªåŠ¨ä¿å­˜ä¸‹è½½è¿›åº¦
    â†“
å…³é—­å½“å‰ç¨‹åº
    â†“
é‡æ–°å¯åŠ¨ç¨‹åº
    â†“
æ–­ç‚¹ç»­ä¼ æ— ç¼æ¢å¤
    â†“
é€Ÿåº¦æ¢å¤æ­£å¸¸ âœ…
```

### 3. å¯é…ç½®å‚æ•°
- **ä½é€Ÿé˜ˆå€¼**ï¼š100 - 2000 KB/sï¼ˆé»˜è®¤500 KB/sï¼‰
- **æŒç»­æ—¶é—´**ï¼š10 - 120ç§’ï¼ˆé»˜è®¤30ç§’ï¼‰
- **é‡å¯å†·å´**ï¼š300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰ï¼Œé¿å…é¢‘ç¹é‡å¯

### 4. é‡å¯ç»Ÿè®¡
- æ˜¾ç¤ºç´¯è®¡é‡å¯æ¬¡æ•°
- è®°å½•é‡å¯æ—¥å¿—åˆ° `auto_restart_log.json`

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
å¯åŠ¨v2è‡ªåŠ¨é‡å¯ç‰ˆ.bat
```

### æ–¹æ³•2ï¼šç›´æ¥è¿è¡Œ

```bash
uv run ERA5download_GUI_v2_auto_restart.py
```

---

## ğŸ“‹ é…ç½®æ­¥éª¤

### ç¬¬1æ­¥ï¼šå¯ç”¨è‡ªåŠ¨é‡å¯

1. å¯åŠ¨ç¨‹åºåï¼Œåœ¨**å·¦ä¾§ä¾§è¾¹æ **æ‰¾åˆ°"å¯ç”¨æ™ºèƒ½è‡ªåŠ¨é‡å¯"
2. å‹¾é€‰å¤é€‰æ¡†
3. ä¼šå‡ºç°é…ç½®é€‰é¡¹ï¼š
   - **ä½é€Ÿé˜ˆå€¼**ï¼šè§¦å‘é‡å¯çš„é€Ÿåº¦é˜ˆå€¼
   - **æŒç»­æ—¶é—´**ï¼šéœ€è¦æŒç»­å¤šä¹…æ‰è§¦å‘é‡å¯

### ç¬¬2æ­¥ï¼šè°ƒæ•´å‚æ•°

#### ä½é€Ÿé˜ˆå€¼æ»‘å—
```
100 KB/s â†â—â”€â”€â”€â”€â”€â”€â”€â”€â†’ 2000 KB/s
        500 KB/s
```

**æ¨èè®¾ç½®**ï¼š
- **ä¿å®ˆ**ï¼š300 KB/sï¼ˆæ›´é¢‘ç¹é‡å¯ï¼‰
- **æ ‡å‡†**ï¼š500 KB/sï¼ˆé»˜è®¤ï¼‰
- **æ¿€è¿›**ï¼š1000 KB/sï¼ˆæ›´æ•æ„Ÿï¼‰

#### æŒç»­æ—¶é—´æ»‘å—
```
10ç§’ â†â—â”€â”€â”€â”€â”€â”€â”€â”€â†’ 120ç§’
       30ç§’
```

**æ¨èè®¾ç½®**ï¼š
- **ä¿å®ˆ**ï¼š60ç§’ï¼ˆé¿å…è¯¯è§¦å‘ï¼‰
- **æ ‡å‡†**ï¼š30ç§’ï¼ˆé»˜è®¤ï¼‰
- **æ¿€è¿›**ï¼š20ç§’ï¼ˆå¿«é€Ÿå“åº”ï¼‰

### ç¬¬3æ­¥ï¼šé…ç½®ä¸‹è½½å‚æ•°

1. **æ—¥æœŸ**ï¼šè¾“å…¥ç›®æ ‡æœˆä»½ï¼ˆå¦‚ 202510ï¼‰
2. **ä¿å­˜æ ¹ç›®å½•**ï¼šé€‰æ‹©ä¿å­˜ä½ç½®
3. **å¹¶å‘çº¿ç¨‹æ•°**ï¼šè°ƒæ•´çº¿ç¨‹æ•°ï¼ˆ1-10ï¼‰
4. **å˜é‡é€‰æ‹©**ï¼šå‹¾é€‰éœ€è¦ä¸‹è½½çš„å˜é‡

### ç¬¬4æ­¥ï¼šå¼€å§‹ä¸‹è½½

ç‚¹å‡»"å¼€å§‹ä¸‹è½½"æŒ‰é’®ï¼Œç¨‹åºä¼šï¼š
1. å¼€å§‹ä¸‹è½½æ–‡ä»¶
2. å®æ—¶ç›‘æ§é€Ÿåº¦ï¼ˆæ¯ç§’æ›´æ–°ï¼‰
3. æ£€æµ‹ä½é€Ÿæ¡ä»¶
4. æ»¡è¶³æ¡ä»¶æ—¶è‡ªåŠ¨é‡å¯

---

## ğŸ› UIç•Œé¢è¯´æ˜

### å·¦ä¾§é…ç½®åŒº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ERA5 ä¸‹è½½åŠ©æ‰‹          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ—¥æœŸ (YYYYMM):          â”‚
â”‚ [202510            ]    â”‚
â”‚                         â”‚
â”‚ ä¿å­˜æ ¹ç›®å½•:             â”‚
â”‚ [é€‰æ‹©æ–‡ä»¶å¤¹...]         â”‚
â”‚ D:\ERA5æ•°æ®             â”‚
â”‚                         â”‚
â”‚ å¹¶å‘çº¿ç¨‹æ•°:             â”‚
â”‚ â”â”â”â—â”â”â”â”â”â”â”â”â”â” 5        â”‚
â”‚                         â”‚
â”‚ â˜‘ å¯ç”¨æ™ºèƒ½è‡ªåŠ¨é‡å¯      â”‚ â† æ–°å¢ï¼
â”‚ é€Ÿåº¦ä½äºé˜ˆå€¼æŒç»­30ç§’å   â”‚
â”‚   è‡ªåŠ¨é‡å¯               â”‚
â”‚                         â”‚
â”‚ ä½é€Ÿé˜ˆå€¼:               â”‚
â”‚ â”â”â”â”â”â—â”â”â”â”â”â”â”â” 500 KB/s â”‚
â”‚                         â”‚
â”‚ æŒç»­æ—¶é—´:               â”‚
â”‚ â”â”â”â”â—â”â”â”â”â”â”â”â”â” 30 ç§’    â”‚
â”‚                         â”‚
â”‚ é‡å¯æ¬¡æ•°: 0             â”‚ â† æ–°å¢ï¼
â”‚                         â”‚
â”‚ [å¼€å§‹ä¸‹è½½]              â”‚
â”‚ [åœæ­¢å¹¶å…³é—­]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å³ä¾§ç›‘æ§åŒº

```
å½“å‰é€Ÿåº¦: 2.5 MB/s  [ä½é€Ÿ (3/6)]
                         â†‘
                    ä½é€Ÿè­¦å‘Šï¼ˆæ–°å¢ï¼‰
```

---

## ğŸ“Š ç›‘æ§é€»è¾‘è¯¦è§£

### é€Ÿåº¦æ£€æµ‹æµç¨‹

```python
# æ¯ç§’æ‰§è¡Œä¸€æ¬¡
def monitor_speed():
    # 1. è®¡ç®—å½“å‰é€Ÿåº¦
    current_speed = è®¡ç®—ä¸‹è½½é€Ÿåº¦()  # bytes/s

    # 2. æ·»åŠ åˆ°å†å²è®°å½•
    speed_history.append({
        'time': å½“å‰æ—¶é—´,
        'speed': current_speed
    })

    # 3. æ£€æŸ¥æ˜¯å¦ä½äºé˜ˆå€¼
    if current_speed < ä½é€Ÿé˜ˆå€¼:
        ä½é€Ÿæ ·æœ¬è®¡æ•° += 1
        æ˜¾ç¤ºè­¦å‘Šï¼š"ä½é€Ÿ (3/6)"
    else:
        ä½é€Ÿæ ·æœ¬è®¡æ•° = 0  # é€Ÿåº¦æ¢å¤ï¼Œé‡ç½®

    # 4. æ£€æŸ¥æ˜¯å¦è¾¾åˆ°é‡å¯æ¡ä»¶
    if ä½é€Ÿæ ·æœ¬è®¡æ•° >= (æŒç»­æ—¶é—´ / 1ç§’):
        è§¦å‘è‡ªåŠ¨é‡å¯()

    # 5. ç»§ç»­ç›‘æ§
    1ç§’åå†æ¬¡è°ƒç”¨
```

### é‡å¯æ¡ä»¶åˆ¤æ–­

**ç¤ºä¾‹**ï¼šé…ç½®ä¸º 500 KB/s, 30ç§’

```
æ—¶åˆ»   é€Ÿåº¦(KB/s)   æ ·æœ¬è®¡æ•°   çŠ¶æ€
0s     1200         0/30      æ­£å¸¸
1s     1100         0/30      æ­£å¸¸
2s     450          1/30      ä½é€Ÿè­¦å‘Š
3s     420          2/30      ä½é€Ÿè­¦å‘Š
4s     400          3/30      ä½é€Ÿè­¦å‘Š
...
30s    350          29/30     ä½é€Ÿè­¦å‘Š
31s    380          30/30     âš ï¸ è§¦å‘é‡å¯ï¼
```

### å†·å´æœºåˆ¶

ä¸ºé¿å…é¢‘ç¹é‡å¯ï¼Œæ·»åŠ äº†5åˆ†é’Ÿå†·å´æ—¶é—´ï¼š

```python
if å½“å‰æ—¶é—´ - ä¸Šæ¬¡é‡å¯æ—¶é—´ > 300ç§’:
    # å¯ä»¥é‡å¯
    è§¦å‘è‡ªåŠ¨é‡å¯()
else:
    # åœ¨å†·å´æœŸ
    æ˜¾ç¤ºï¼š"å†·å´ä¸­ï¼Œè¿˜éœ€ XX ç§’æ‰èƒ½é‡å¯"
```

---

## ğŸ” å®é™…ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ­£å¸¸ä¸‹è½½

```
å¯åŠ¨ â†’ é€Ÿåº¦ 15 MB/s â†’ æŒç»­ç¨³å®š â†’ ä¸‹è½½å®Œæˆ
```

**æ— éœ€é‡å¯**ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚

### åœºæ™¯2ï¼šé€Ÿåº¦ä¸‹é™å¹¶æ¢å¤

```
å¯åŠ¨ â†’ 15 MB/s â†’ 8 MB/s â†’ 12 MB/s â†’ ç»§ç»­...
```

**æ— éœ€é‡å¯**ï¼Œé€Ÿåº¦çŸ­æš‚ä¸‹é™åæ¢å¤ã€‚

### åœºæ™¯3ï¼šé€Ÿåº¦æŒç»­ä¸‹é™ï¼ˆè§¦å‘é‡å¯ï¼‰

```
å¯åŠ¨ â†’ 15 MB/s â†’ 10 MB/s â†’ 5 MB/s â†’ 3 MB/s â†’ 2 MB/s â†’ 1 MB/s
                                                 â†“
                                              æŒç»­30ç§’
                                                 â†“
                                           [è‡ªåŠ¨é‡å¯]
                                                 â†“
é‡å¯ â†’ é‡æ–°åŠ è½½é…ç½® â†’ æ–­ç‚¹ç»­ä¼  â†’ é€Ÿåº¦æ¢å¤ 15 MB/s â†’ ç»§ç»­...
```

**è§¦å‘è‡ªåŠ¨é‡å¯**ï¼Œé€Ÿåº¦æ¢å¤ã€‚

### åœºæ™¯4ï¼šå¤šæ¬¡é‡å¯

```
ç¬¬1æ¬¡ä¸‹è½½ â†’ é€Ÿåº¦ä¸‹é™ â†’ è‡ªåŠ¨é‡å¯(1) â†’ ç»§ç»­...
                                 â†“
                            é€Ÿåº¦åˆä¸‹é™
                                 â†“
                          è‡ªåŠ¨é‡å¯(2) â†’ ç»§ç»­...
```

**æ˜¾ç¤º**ï¼š`é‡å¯æ¬¡æ•°: 2`

---

## ğŸ“ é‡å¯æ—¥å¿—

ç¨‹åºä¼šè®°å½•æ¯æ¬¡é‡å¯çš„è¯¦ç»†ä¿¡æ¯åˆ° `auto_restart_log.json`ï¼š

```json
{"time": "2026-02-10 15:30:45", "restart_count": 1, "low_speed_duration": 30, "threshold": 512000}
{"time": "2026-02-10 16:45:20", "restart_count": 2, "low_speed_duration": 30, "threshold": 512000}
```

**æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
type auto_restart_log.json
```

---

## âš™ï¸ é«˜çº§é…ç½®

### ä¿®æ”¹é»˜è®¤å€¼

ç¼–è¾‘é…ç½®æ–‡ä»¶ `.era5_gui_config.json`ï¼š

```json
{
  "date": "202510",
  "local_root": "D:\\ERA5æ•°æ®",
  "thread_count": 5,
  "selected_vars": [],
  "auto_restart_enabled": true,
  "low_speed_threshold": 500,
  "low_speed_duration": 30
}
```

### é…ç½®è¯´æ˜

| å‚æ•° | èŒƒå›´ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `auto_restart_enabled` | true/false | false | æ˜¯å¦å¯ç”¨è‡ªåŠ¨é‡å¯ |
| `low_speed_threshold` | 100-2000 | 500 | ä½é€Ÿé˜ˆå€¼ï¼ˆKB/sï¼‰ |
| `low_speed_duration` | 10-120 | 30 | æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ |

---

## ğŸ¯ é…ç½®å»ºè®®

### åœºæ™¯1ï¼šç½‘ç»œä¸ç¨³å®š

```
ä½é€Ÿé˜ˆå€¼: 300 KB/s
æŒç»­æ—¶é—´: 60 ç§’
```
â†’ é¿å…é¢‘ç¹é‡å¯ï¼Œæ›´ç¨³å®š

### åœºæ™¯2ï¼šè¿½æ±‚é€Ÿåº¦

```
ä½é€Ÿé˜ˆå€¼: 1000 KB/s
æŒç»­æ—¶é—´: 20 ç§’
```
â†’ å¿«é€Ÿæ£€æµ‹å’Œæ¢å¤

### åœºæ™¯3ï¼šæ ‡å‡†ä½¿ç”¨

```
ä½é€Ÿé˜ˆå€¼: 500 KB/s
æŒç»­æ—¶é—´: 30 ç§’
```
â†’ å¹³è¡¡æ€§èƒ½å’Œç¨³å®šæ€§ï¼ˆé»˜è®¤æ¨èï¼‰

### åœºæ™¯4ï¼šé•¿æ—¶é—´æ— äººå€¼å®ˆ

```
ä½é€Ÿé˜ˆå€¼: 300 KB/s
æŒç»­æ—¶é—´: 45 ç§’
```
â†’ æ›´ä¿å®ˆï¼Œé¿å…è¯¯è§¦å‘ï¼Œé€‚åˆå¤œé—´ä¸‹è½½

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ–­ç‚¹ç»­ä¼ 

**é‡è¦**ï¼šè‡ªåŠ¨é‡å¯ä¾èµ–æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ã€‚

**ç¡®ä¿è¿›åº¦æ–‡ä»¶å­˜åœ¨**ï¼š
```
D:\ERA5æ•°æ®\202510\.era5_download_progress.json
```

**å†…å®¹ç¤ºä¾‹**ï¼š
```json
{
  "completed": [
    "e5.oper.an.pl.128_130_t.ll025sc.2025100100_2025100100.nc",
    "e5.oper.an.pl.128_130_t.ll025sc.2025100101_2025100101.nc"
  ],
  "date": "2026-02-10 15:30:00"
}
```

### 2. é‡å¯æ—¶è‡ªåŠ¨ä¿å­˜

ç¨‹åºåœ¨é‡å¯å‰ä¼šï¼š
- âœ… è‡ªåŠ¨ä¿å­˜ä¸‹è½½è¿›åº¦
- âœ… ä¿ç•™ä¸´æ—¶æ–‡ä»¶ï¼ˆ`.tmp`ï¼‰
- âœ… ä¿å­˜é…ç½®æ–‡ä»¶
- âœ… è®°å½•é‡å¯æ—¥å¿—

### 3. é‡å¯åè‡ªåŠ¨æ¢å¤

é‡æ–°å¯åŠ¨ç¨‹åºåï¼š
- âœ… è‡ªåŠ¨åŠ è½½é…ç½®
- âœ… è‡ªåŠ¨åŠ è½½è¿›åº¦
- âœ… è·³è¿‡å·²å®Œæˆæ–‡ä»¶
- âœ… ç»§ç»­ä¸‹è½½æœªå®Œæˆæ–‡ä»¶

**æ“ä½œ**ï¼šåªéœ€ç‚¹å‡»"å¼€å§‹ä¸‹è½½"æŒ‰é’®å³å¯

### 4. å†·å´æ—¶é—´

ä¸ºé¿å…é¢‘ç¹é‡å¯ï¼Œæ·»åŠ äº†5åˆ†é’Ÿå†·å´æ—¶é—´ï¼š

- ç¬¬ä¸€æ¬¡é‡å¯ï¼šç«‹å³æ‰§è¡Œ
- ç¬¬äºŒæ¬¡é‡å¯ï¼šéœ€ç­‰å¾…5åˆ†é’Ÿ
- å†·å´ä¸­ä¼šæ˜¾ç¤ºï¼š"è¿˜éœ€ XX ç§’æ‰èƒ½é‡å¯"

### 5. é…ç½®æŒä¹…åŒ–

æ‰€æœ‰é…ç½®è‡ªåŠ¨ä¿å­˜åˆ° `.era5_gui_config.json`ï¼š
- æ—¥æœŸè®¾ç½®
- ä¿å­˜è·¯å¾„
- çº¿ç¨‹æ•°
- å˜é‡é€‰æ‹©
- **è‡ªåŠ¨é‡å¯é…ç½®**ï¼ˆæ–°å¢ï¼‰

ä¸‹æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤ã€‚

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ²¡æœ‰è§¦å‘è‡ªåŠ¨é‡å¯

**å¯èƒ½åŸå› **ï¼š
1. è‡ªåŠ¨é‡å¯æœªå¯ç”¨
2. é€Ÿåº¦ä¸€ç›´é«˜äºé˜ˆå€¼
3. æŒç»­æ—¶é—´ä¸å¤Ÿ

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥æ˜¯å¦å‹¾é€‰"å¯ç”¨æ™ºèƒ½è‡ªåŠ¨é‡å¯"
2. æŸ¥çœ‹é€Ÿåº¦è­¦å‘Šï¼š"ä½é€Ÿ (X/XX)"
3. é™ä½é˜ˆå€¼æˆ–å»¶é•¿æ—¶é—´

---

### é—®é¢˜2ï¼šé¢‘ç¹è§¦å‘é‡å¯

**å¯èƒ½åŸå› **ï¼š
1. é˜ˆå€¼è®¾ç½®è¿‡é«˜
2. æŒç»­æ—¶é—´è®¾ç½®è¿‡çŸ­
3. ç½‘ç»œæœ¬èº«ä¸ç¨³å®š

**è§£å†³æ–¹æ³•**ï¼š
1. æé«˜é˜ˆå€¼ï¼ˆå¦‚ 1000 KB/sï¼‰
2. å»¶é•¿æŒç»­æ—¶é—´ï¼ˆå¦‚ 60ç§’ï¼‰
3. æˆ–è€…ç¦ç”¨è‡ªåŠ¨é‡å¯åŠŸèƒ½

---

### é—®é¢˜3ï¼šé‡å¯åè¿›åº¦ä¸¢å¤±

**å¯èƒ½åŸå› **ï¼š
- è¿›åº¦æ–‡ä»¶æœªç”Ÿæˆæˆ–æŸå

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥æ˜¯å¦å­˜åœ¨ `.era5_download_progress.json`
2. æ‰‹åŠ¨æ£€æŸ¥å·²å®Œæˆçš„ `.nc` æ–‡ä»¶
3. ç¨‹åºä¼šè‡ªåŠ¨è·³è¿‡å·²å®Œæˆçš„æ–‡ä»¶

---

### é—®é¢˜4ï¼šé‡å¯åæ— æ³•è‡ªåŠ¨å¯åŠ¨

**è¯´æ˜**ï¼šå½“å‰ç‰ˆæœ¬éœ€è¦æ‰‹åŠ¨ç‚¹å‡»"å¼€å§‹ä¸‹è½½"

**æ“ä½œæ­¥éª¤**ï¼š
1. ç¨‹åºè‡ªåŠ¨é‡å¯åä¼šå¼¹å‡ºæç¤ºæ¡†
2. ç‚¹å‡»"ç¡®å®š"å…³é—­æç¤ºæ¡†
3. å†æ¬¡ç‚¹å‡»"å¼€å§‹ä¸‹è½½"æŒ‰é’®
4. ç¨‹åºä¼šè‡ªåŠ¨æ–­ç‚¹ç»­ä¼ 

**æœªæ¥æ”¹è¿›**ï¼šå¯ä»¥å®ç°å®Œå…¨è‡ªåŠ¨é‡å¯ï¼Œæ— éœ€æ‰‹åŠ¨ç‚¹å‡»

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### v2åŸå§‹ç‰ˆæœ¬

```
æ—¶é—´: 0   30min  60min  90min  120min
é€Ÿåº¦: 15  â†’  10    â†’ 7     â†’ 5      â†’ 3
                        â†“é€Ÿåº¦è¡°å‡
é‡å¯: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      æ‰‹åŠ¨é‡å¯ï¼Œæ¢å¤é€Ÿåº¦
é€Ÿåº¦: 15  â†’  12    â†’ 8     â†’ 6      â†’ 4
```

**é—®é¢˜**ï¼š
- âŒ éœ€è¦äººå·¥ç›‘æ§
- âŒ éœ€è¦æ‰‹åŠ¨é‡å¯
- âŒ å¤œé—´ä¸‹è½½æ— æ³•åŠæ—¶å¤„ç†

### v2.1è‡ªåŠ¨é‡å¯ç‰ˆ

```
æ—¶é—´: 0   30min  60min  90min  120min
é€Ÿåº¦: 15  â†’ 12    â†’ 5     [è‡ªåŠ¨] â†’ 12    â†’ 11
                           â†“           â†“
                      æ£€æµ‹åˆ°ä½é€Ÿ   è‡ªåŠ¨é‡å¯
                           â†“           â†“
                      é€Ÿåº¦: 15    æ¢å¤æ­£å¸¸
```

**ä¼˜åŠ¿**ï¼š
- âœ… å®Œå…¨è‡ªåŠ¨åŒ–
- âœ… æ— éœ€äººå·¥ç›‘æ§
- âœ… é€‚åˆé•¿æ—¶é—´/æ— äººå€¼å®ˆä¸‹è½½
- âœ… è‡ªåŠ¨æ¢å¤æ€§èƒ½

---

## ğŸ‰ ä½¿ç”¨å»ºè®®

### æ¨èåœºæ™¯

**âœ… é€‚åˆä½¿ç”¨è‡ªåŠ¨é‡å¯**ï¼š
- é•¿æ—¶é—´ä¸‹è½½ï¼ˆ> 2å°æ—¶ï¼‰
- æ— äººå€¼å®ˆä¸‹è½½ï¼ˆå¤œé—´/å‘¨æœ«ï¼‰
- ç½‘ç»œä¸ç¨³å®šç¯å¢ƒ
- è¿½æ±‚ç¨³å®šæ€§

**âŒ ä¸é€‚åˆä½¿ç”¨è‡ªåŠ¨é‡å¯**ï¼š
- çŸ­æ—¶é—´ä¸‹è½½ï¼ˆ< 30åˆ†é’Ÿï¼‰
- ç½‘ç»œæœ¬èº«å°±å¾ˆæ…¢
- éœ€è¦ç²¾ç¡®æ§åˆ¶é‡å¯æ—¶æœº

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `v2.1æ–°åŠŸèƒ½è¯´æ˜.md` - æœ¬æ–‡æ¡£
- `æ™ºèƒ½æ¢å¤åŠŸèƒ½Bugä¿®å¤è¯´æ˜.md` - v3.1ç‹¬ç«‹ç›‘æ§ç‰ˆçš„ä¿®å¤è¯´æ˜
- `v3.0æ–°åŠŸèƒ½è¯´æ˜.md` - v3.0åŠŸèƒ½è¯¦è§£

---

## ğŸ’¡ æŠ€æœ¯å®ç°

### æ ¸å¿ƒä»£ç é€»è¾‘

```python
def monitor_speed(self):
    """å¸¦è‡ªåŠ¨é‡å¯æ£€æµ‹çš„é€Ÿåº¦ç›‘æ§"""
    if not self.is_downloading:
        return

    # 1. è®¡ç®—å½“å‰é€Ÿåº¦
    curr = sum(self.thread_bytes.values()) + self.total_bytes
    diff = curr - self.last_bytes
    self.last_bytes = curr

    # 2. æ ¼å¼åŒ–æ˜¾ç¤º
    speed_kbps = diff / 1024
    self.speed_label.configure(text=f"å½“å‰é€Ÿåº¦: {speed_text}")

    # 3. è‡ªåŠ¨é‡å¯æ£€æµ‹
    if self.auto_restart_enabled:
        # è®°å½•é€Ÿåº¦å†å²
        self.speed_history.append({'time': time.time(), 'speed': diff})

        # æ£€æŸ¥æ˜¯å¦ä½äºé˜ˆå€¼
        if diff < self.low_speed_threshold:
            self.low_speed_samples += 1
            required_samples = self.low_speed_duration // self.speed_check_interval

            # æ˜¾ç¤ºè­¦å‘Š
            self.speed_warning_label.configure(text=f"ä½é€Ÿ ({self.low_speed_samples}/{required_samples})")

            # æ£€æŸ¥æ˜¯å¦è¾¾åˆ°é‡å¯æ¡ä»¶
            if self.low_speed_samples >= required_samples:
                if time.time() - self.last_restart_time > self.restart_cooldown:
                    self.trigger_auto_restart()
                    return
        else:
            # é€Ÿåº¦æ­£å¸¸ï¼Œé‡ç½®
            self.low_speed_samples = 0
            self.speed_warning_label.configure(text="")

    # ç»§ç»­ç›‘æ§
    self.after(1000, self.monitor_speed)

def trigger_auto_restart(self):
    """è§¦å‘è‡ªåŠ¨é‡å¯"""
    # 1. ä¿å­˜è¿›åº¦
    self._flush_progress(self.current_download_dir)

    # 2. è®°å½•æ—¥å¿—
    restart_log = {
        'time': time.strftime('%Y-%m-%d %H:%M:%S'),
        'restart_count': self.restart_count
    }

    # 3. å…³é—­è¿æ¥
    self.s3_client._endpoint.http_session.close()

    # 4. æç¤ºç”¨æˆ·
    messagebox.showinfo("è‡ªåŠ¨é‡å¯", "ç¨‹åºå°†è‡ªåŠ¨é‡å¯ä»¥æ¢å¤æ€§èƒ½")

    # 5. é‡æ–°å¯åŠ¨
    self.restart_program()

def restart_program(self):
    """é‡æ–°å¯åŠ¨ç¨‹åº"""
    script_path = os.path.abspath(sys.argv[0])

    # ä½¿ç”¨subprocessé‡æ–°å¯åŠ¨
    subprocess.Popen([sys.executable, script_path])

    # é€€å‡ºå½“å‰è¿›ç¨‹
    os._exit(0)
```

---

## ğŸ¯ æ€»ç»“

### v2.1 çš„å…³é”®æ”¹è¿›

1. **é›†æˆç›‘æ§** - æ— éœ€å¤–éƒ¨è„šæœ¬ï¼Œå†…ç½®é€Ÿåº¦ç›‘æ§
2. **æ™ºèƒ½æ£€æµ‹** - è‡ªåŠ¨è¯†åˆ«é€Ÿåº¦æŒç»­ä¸‹é™
3. **è‡ªåŠ¨é‡å¯** - æ— éœ€äººå·¥å¹²é¢„ï¼Œè‡ªåŠ¨æ¢å¤æ€§èƒ½
4. **æ–­ç‚¹ç»­ä¼ ** - é‡å¯åæ— ç¼æ¢å¤ä¸‹è½½
5. **å¯é…ç½®** - çµæ´»è°ƒæ•´é˜ˆå€¼å’Œå‚æ•°
6. **UIé›†æˆ** - ç›´è§‚çš„é…ç½®ç•Œé¢

### é€‚ç”¨ç‰ˆæœ¬

- **v2ç”¨æˆ·**ï¼šç›´æ¥å‡çº§åˆ°v2.1ï¼Œè·å¾—è‡ªåŠ¨é‡å¯åŠŸèƒ½
- **v3ç”¨æˆ·**ï¼šv3.1å·²æœ‰ç‹¬ç«‹ç›‘æ§ç‰ˆï¼Œå¯é€‰æ‹©ä½¿ç”¨

---

**ç°åœ¨å¯ä»¥æ”¾å¿ƒåœ°è¿›è¡Œé•¿æ—¶é—´ä¸‹è½½äº†ï¼** ğŸš€

å¯åŠ¨å‘½ä»¤ï¼š
```bash
å¯åŠ¨v2è‡ªåŠ¨é‡å¯ç‰ˆ.bat
```
