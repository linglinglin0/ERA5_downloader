# 变更记录

本文档记录 ERA5 数据下载工具的所有重要变更。

---

## [3.1.0] - 2025-02-14

### 性能优化
- ✅ 修复 HTTP 响应连接泄漏问题
- ✅ 增加连接池大小 (workers×2 → workers×4)
- ✅ 优化超时配置 (connect/read timeout)
- ✅ 实现线程局部计数器，减少锁竞争
- ✅ 批量更新进度文件，减少磁盘 I/O
- ✅ 动态调整 UI 更新频率

### 性能提升
- 🚀 下载速度提升 50-70%
- 📉 错误率降低 75% (80% → <20%)
- 📊 长期稳定性提升 (速度衰减 46% → 8%)

### 新增功能
- 📊 内置性能监控日志
- 🔧 诊断工具 (`scripts/diagnostic.py`)
- 📝 日志分析器 (`scripts/log_analyzer.py`)

### 文档
- ✅ 重构项目目录结构
- ✅ 创建完整的用户指南
- ✅ 添加性能优化报告
- ✅ 编写 API 参考文档

---

## [3.0.0] - 2025-01-19

### 重大变更
- ✅ 实现完整的断点续传功能
- ✅ 添加临时文件 (`.tmp`) 管理
- ✅ 支持智能重试机制（指数退避）
- ✅ 失败文件追踪和报告

### 性能改进
- 🔧 优化 S3 客户端配置
- 🔧 TCP keepalive 保持连接
- 🔧 限制内部重试次数

### Bug 修复
- 🐛 修复文件不完整检测
- 🐛 修复进度文件保存错误
- 🐛 修复 UI 线程安全问题

---

## [2.2.0] - 2025-01-15

### 新增功能
- ✅ 配置自动保存和加载
- ✅ 支持变量选择过滤
- ✅ 添加下载进度监控面板
- ✅ 实时速度显示

### 改进
- 🎨 优化 GUI 布局
- 📊 改进进度条显示
- 🔔 添加系统日志反馈

---

## [2.1.0] - 2025-01-10

### 新增功能
- ✅ 多线程并发下载 (1-10 线程)
- ✅ 线程池管理
- ✅ 实时下载进度监控

### 性能优化
- ⚡ 并发下载提速 3-5 倍
- 🔧 动态线程槽分配

---

## [2.0.0] - 2025-01-05

### 初始版本
- ✅ 基础 GUI 界面
- ✅ S3 文件浏览和下载
- ✅ 日期和目录选择
- ✅ 变量勾选功能

### 技术栈
- CustomTkinter GUI 框架
- Boto3 S3 客户端
- 单线程下载

---

## 版本命名规则

- **主版本 (Major)**: 重大架构变更
- **次版本 (Minor)**: 新增功能
- **修订版本 (Patch)**: Bug 修复

示例: `3.1.0`
- `3` - 主版本
- `1` - 次版本（新功能）
- `0` - 修订版本（无修复）

---

## 即将发布

### [3.2.0] - 计划中

- [ ] 支持多个月份批量下载
- [ ] 添加命令行接口 (CLI)
- [ ] 实现配置文件外部化
- [ ] 优化内存占用

### [4.0.0] - 规划中

- [ ] 异步架构重构 (asyncio)
- [ ] 支持 ERA5-Land 数据集
- [ ] Web 界面 (FastAPI + Vue)
- [ ] 分布式下载 (P2P)

---

## 已知问题

### 当前版本 (3.1.0)

- [ ] macOS 上 GUI 可能出现字体渲染问题
- [ ] 某些网络环境需要代理配置
- [ ] 大文件 (>1GB) 下载可能不稳定

### 下版本修复计划

- 3.2: 修复 macOS 字体问题
- 3.3: 改进大文件稳定性
- 4.0: 完全异步架构解决稳定性问题

---

## 贡献者

感谢所有为项目做出贡献的开发者！

- **核心开发**: ERA5 Downloader Team
- **AI 辅助**: Claude Code (Anthropic)
- **测试反馈**: 社区用户

---

## 升级指南

### 从 2.x 升级到 3.1

1. **备份数据**
   ```bash
   cp .era5_gui_config.json config_backup.json
   ```

2. **更新代码**
   ```bash
   git pull origin main
   ```

3. **更新依赖**
   ```bash
   pip install -r requirements.txt --upgrade
   ```

4. **验证功能**
   - 运行诊断工具
   - 测试小批量下载
   - 检查性能提升

### 配置迁移

旧版本配置自动兼容，无需手动迁移。

---

**最后更新**: 2025-02-14
**当前版本**: 3.1.0
