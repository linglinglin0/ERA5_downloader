# ERA5下载器 - 版本总览

## 📦 所有版本

| 版本 | 文件名 | 主要特性 | 适用场景 |
|------|--------|---------|---------|
| **v2_fixed** | `ERA5download_GUI_v2_fixed.py` | 基础下载 + 断点续传 + 性能优化 | 稳定使用 |
| **v2.1** | `ERA5download_GUI_v2_auto_restart.py` | **v2 + 内置自动重启** | 日常下载推荐 |
| **v3.0** | `ERA5download_GUI_v3.py` | 高级特性 + 性能监控 | 专业使用 |
| **v3.1** | `ERA5_AutoRecovery.py` | **独立自动重启监控** | 配合v3.0使用 |

---

## 🚀 快速启动

### 日常下载（推荐 v2.1）

```bash
启动v2自动重启版.bat
```

**特点**：
- ✅ 简单易用，GUI配置
- ✅ 内置自动重启
- ✅ 无需额外依赖

### 专业使用（v3.0 + v3.1）

```bash
# 终端1：启动性能监控器
启动性能监控.bat

# 终端2：启动智能恢复版
启动智能恢复版.bat
```

**特点**：
- ✅ 详细性能监控
- ✅ 实时图表显示
- ✅ 独立监控脚本

---

## 📋 版本选择指南

```
你的需求
   │
   ├─ 需要自动重启？
   │   │
   │   ├─ 是 → 想要简单？
   │   │       │
   │   │       ├─ 是 → v2.1 集成版 ⭐推荐
   │   │       │
   │   │       └─ 否 → v3.1 独立监控版
   │   │
   │   └─ 否 → v2_fixed 基础版
   │
   └─ 需要性能监控？
       │
       ├─ 是 → v3.0 高级版
       │
       └─ 否 → v2_fixed 基础版
```

---

## 📊 详细对比

### v2_fixed - 基础稳定版

**文件**：`ERA5download_GUI_v2_fixed.py`

**特性**：
- ✅ 断点续传
- ✅ 连接池优化
- ✅ 性能修复
- ✅ 批量进度保存

**启动**：
```bash
启动程序_v2.bat
```

**适用**：
- 日常稳定使用
- 不需要自动重启
- 不需要性能监控

---

### v2.1 - 智能自动重启版 ⭐ 推荐

**文件**：`ERA5download_GUI_v2_auto_restart.py`

**特性**：
- ✅ v2所有特性
- ✅ **内置自动重启**
- ✅ 实时速度监控
- ✅ GUI配置界面
- ✅ 重启统计

**启动**：
```bash
启动v2自动重启版.bat
```

**适用**：
- 长时间下载（>2小时）
- 无人值守下载
- 网络不稳定环境
- **日常下载首选**

**文档**：`v2自动重启版使用说明.md`

---

### v3.0 - 高级特性版

**文件**：`ERA5download_GUI_v3.py`

**特性**：
- ✅ v2所有特性
- ✅ **性能监控数据库**
- ✅ 自适应限流
- ✅ 连接池重建
- ✅ 高级统计

**启动**：
```bash
启动程序_v3.bat
```

**适用**：
- 需要性能分析
- 研究项目使用
- 需要详细日志

**文档**：`v3.0新功能说明.md`

---

### v3.1 - 独立监控版

**文件**：`ERA5_AutoRecovery.py`

**特性**：
- ✅ 独立监控脚本
- ✅ 读取性能数据库
- ✅ 自动重启v3.0
- ✅ 后台运行

**启动**：
```bash
启动智能恢复版.bat
```

**适用**：
- 配合v3.0使用
- 需要性能监控
- 需要独立监控

**文档**：`智能自动恢复功能说明.md`

---

## 🎯 推荐组合

### 组合1：简单下载

```
v2.1 自动重启版
```

**适用**：大多数日常下载场景

### 组合2：专业监控

```
v3.0 高级版 + 性能监控器
```

**适用**：需要性能数据和分析

### 组合3：完全自动化

```
v3.0 高级版 + 性能监控器 + v3.1 独立监控
```

**适用**：长时间无人值守下载

---

## 📝 配置文件说明

### 通用配置

- `.era5_gui_config.json` - GUI配置（日期、路径、变量）
- `.era5_download_progress.json` - 下载进度（断点续传）

### v2.1 特有

- `.era5_gui_config.json` - 包含自动重启配置
- `auto_restart_log.json` - 重启日志

### v3.0/v3.1 特有

- `.era5_auto_recovery_config.json` - 自动恢复配置
- `era5_performance.db` - 性能监控数据库

---

## 🔧 常见问题

### Q: 应该选择哪个版本？

**A**:
- 日常使用 → **v2.1**（推荐）
- 专业研究 → v3.0 + 性能监控器
- 完全自动化 → v3.0 + v3.1

### Q: v2.1 和 v3.1 的自动重启有什么区别？

**A**:
- **v2.1**：内置在下载器中，单一程序，简单
- **v3.1**：独立监控脚本，需要配合v3.0和性能监控器

详见：`版本对比指南_v2.1_vs_v3.1.md`

### Q: 可以同时运行多个版本吗？

**A**:
- 不建议。同时运行多个下载器可能导致：
  - 速度竞争
  - 进度文件冲突
  - 资源占用过高

建议只运行一个下载器实例。

### Q: 如何升级版本？

**A**:
1. 停止当前下载器
2. 配置文件自动兼容（.era5_gui_config.json）
3. 启动新版本
4. 进度文件自动加载

### Q: 断点续传如何工作？

**A**:
- 下载中的文件保存为 `.tmp` 后缀
- 下载完成后重命名为 `.nc`
- 已完成的文件记录在 `.era5_download_progress.json`
- 重启后自动跳过已完成文件

---

## 📚 相关文档

### 用户指南
- `v2自动重启版使用说明.md` - v2.1详细使用说明
- `智能自动恢复功能说明.md` - v3.1功能说明
- `v3.0新功能说明.md` - v3.0功能详解

### 技术文档
- `版本对比指南_v2.1_vs_v3.1.md` - v2.1和v3.1详细对比
- `智能恢复功能Bug修复说明.md` - v3.1的bug修复记录
- `网络接口监控说明.md` - 性能监控器原理

### 监控和日志
- `auto_restart_log.json` - v2.1重启日志
- `era5_performance.db` - v3.0性能数据库
- `download_errors.log` - 下载错误日志

---

## 🎉 快速开始

### 第一次使用

1. **选择版本**
   ```bash
   # 推荐使用v2.1
   启动v2自动重启版.bat
   ```

2. **配置参数**
   - 日期：输入目标月份（如 202510）
   - 保存路径：选择保存位置
   - 线程数：3-5（推荐）

3. **启用自动重启**（v2.1）
   - 勾选"启用智能自动重启"
   - 阈值：500 KB/s（默认）
   - 持续时间：30秒（默认）

4. **开始下载**
   - 点击"开始下载"
   - 程序会自动监控速度
   - 速度过低时自动重启

---

## 💡 最佳实践

### 1. 长时间下载

```
推荐配置：
- 版本：v2.1 自动重启版
- 阈值：300 KB/s
- 持续时间：60秒
- 线程数：3-5
```

### 2. 快速下载

```
推荐配置：
- 版本：v2_fixed 基础版
- 线程数：5-8
- 不启用自动重启
```

### 3. 研究项目

```
推荐配置：
- 版本：v3.0 + 性能监控器
- 记录详细性能数据
- 分析速度曲线
```

---

## 🚀 性能优化建议

### 网络优化
- 线程数：3-5（稳定）
- 不超过：10（可能导致限流）
- 使用有线网络（更稳定）

### 系统优化
- 关闭不必要的网络活动
- 使用SSD存储（更快）
- 定期清理临时文件

### 自动重启优化
- 保守：300 KB/s, 60秒
- 标准：500 KB/s, 30秒
- 激进：1000 KB/s, 20秒

---

## 📞 技术支持

### 问题反馈
- 检查日志文件
- 查看错误信息
- 参考故障排查文档

### 日志位置
- 下载错误：`download_errors.log`
- 重启日志：`auto_restart_log.json`
- 性能数据：`era5_performance.db`

---

**选择适合你的版本，开始高效下载吧！** 🚀
