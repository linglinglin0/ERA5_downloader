# ERA5 数据下载工具 - 打包使用说明

## 📦 文件夹结构

```
era5_downloader/           ← 主文件夹（分发给用户）
├── ERA5数据下载工具.exe    ← 主程序（双击运行）
├── _internal/               ← 内部依赖（用户无需关心）
│   ├── Python 运行时
│   ├── 依赖库（boto3, customtkinter 等）
│   └── ...
├── README.md                ← 使用说明
└── （可选）其他文件
```

## 🚀 用户使用方法

### 方法 1：GUI 模式（推荐）

1. **双击运行** `ERA5数据下载工具.exe`
2. **首次使用**：
   - 输入日期（格式：YYYYMM，如 202510）
   - 点击"选择文件夹"设置保存位置
   - 勾选需要下载的变量（可选）
   - 拖动滑块设置线程数（推荐 5）
3. **点击"开始下载"**
4. **监控进度** - 实时显示下载速度和进度

### 方法 2：自动模式（命令行）

1. **打开命令提示符**（cmd）
2. **切换到程序文件夹**
   ```cmd
   cd /d "路径\to\era5_downloader"
   ```
3. **运行自动模式**
   ```cmd
   "ERA5数据下载工具.exe" --auto
   ```
   或
   ```cmd
   "ERA5数据下载工具.exe" -a
   ```

## 📋 分发方式

### 方案 1：ZIP 压缩包（推荐）

```bash
# 压缩整个文件夹
# Windows 右键 → 右送到 → 压缩(zipped) 文件夹
# 或命令行
powershell Compress-Archive -Path era5_downloader -DestinationPath ERA5下载工具_v2.1.zip
```

**优点**：
- ✅ 用户解压后双击即可使用
- ✅ 不需要安装任何依赖
- ✅ 可以离线使用

### 方案 2：安装程序（可选）

使用 **NSIS** 或 **Inno Setup** 创建安装程序：

**示例 NSIS 脚本**：
```nsis
; ERA5下载工具安装脚本
!define APPNAME "ERA5数据下载工具"
!define APPVERSION "2.1.0"

Name "${APPNAME} ${APPVERSION}"
OutFile "ERA5下载工具_Setup_v${APPVERSION}.exe"
InstallDir "$PROGRAMFILES\${APPNAME}"

Page directory
Page instfiles

Section "主程序"
    SetOutPath $INSTDIR
    File /r "dist\era5_downloader\*.*"
    CreateShortcut "$INSTDIR\ERA5数据下载工具.exe" "$DESKTOP\ERA5数据下载工具.lnk"
SectionEnd
```

## 🎯 优化体积（可选）

如果体积超过 100MB，可以尝试以下优化：

### 1. 启用 UPX 压缩（已在配置中启用）

在 `.spec` 文件中确认：
```python
upx=True  # EXE 和 COLLECT 都设置
```

### 2. 排除不需要的模块

编辑 `.spec` 文件：
```python
excludes=[
    'matplotlib',  # 如果不用可视化
    'pytest',    # 测试框架
    'pandas',     # 数据处理
    'numpy',      # 数值计算
    'scipy',      # 科学计算
    # 添加其他不需要的模块
],
```

### 3. 使用虚拟环境打包

```bash
# 创建干净的虚拟环境
python -m venv venv
call venv\Scripts\activate

# 只安装必需依赖
pip install customtkinter boto3

# 打包
python -m PyInstaller era5_downloader.spec
```

这样可以减小 20-40% 的体积。

## 📊 打包清单

### 标准版（推荐）

- **主程序**: `ERA5数据下载工具.exe`
- **文档**: `README.md`
- **体积**: 约 50-80 MB
- **用途**: 适合大多数用户

### 完整版（可选）

额外包含：
- **文档文件夹**: `docs/`（完整文档）
- **快速开始指南**: `快速开始.md`
- **故障排除**: `常见问题.md`
- **体积**: 约 80-120 MB

### 轻简版（最小化）

只包含：
- **主程序**: `ERA5数据下载工具.exe`
- **简明说明**: `使用说明.txt`
- **体积**: 约 40-60 MB

## ⚠️ 常见问题

### Q1: 杀毒软件报毒？

**原因**：PyInstaller 打包的程序可能被误报

**解决方法**：
1. 添加数字签名（需要证书）
2. 上传到 VirusTotal 检测
3. 在说明中提醒用户添加信任

### Q2: Windows Defender 阻止运行？

**解决方法**：
1. 打开 Windows 安全中心
2. 选择"病毒和威胁防护"→"管理设置"
3. 添加排除项：`ERA5数据下载工具.exe`

### Q3: 程序闪退？

**可能原因**：
- 缺少 VC++ Redistributable
- 系统不兼容

**解决方法**：
1. 安装 [VC++ 运行时](https://aka.ms/vs/17/release/vc_redist.x64.exe)
2. 检查 Windows 版本（需要 Windows 7 或更高）

### Q4: 下载速度慢？

**这不是打包问题**，但可以：
- 提供网络优化建议
- 建议用户调整线程数
- 说明断点续传功能

## 🔄 更新流程

当代码更新后：

```bash
# 1. 修改版本号（GUI 程序标题）
# 2. 运行打包脚本
build.bat

# 3. 测试打包后的程序
cd dist\era5_downloader
"ERA5数据下载工具.exe"

# 4. 压缩分发
powershell Compress-Archive -Path ..\dist\era5_downloader -DestinationPath ..\ERA5下载工具_v2.1.zip

# 5. 上传到 GitHub Releases
gh release create v2.1.0 --title "v2.1.0" --notes "更新说明"
gh release upload v2.1.0 ..\ERA5下载工具_v2.1.zip
```

## 📊 推荐的分发方式

### GitHub Releases（推荐）

```bash
# 创建 Release
gh release create v2.1.0 \
  --title "ERA5 数据下载工具 v2.1.0" \
  --notes "## 新功能\n- 实时进度显示\n- 断点续传\n- 配置记忆"

# 上传打包文件
gh release upload v2.1.0 dist/era5_downloader.zip
```

**优点**：
- ✅ 版本管理清晰
- ✅ 自动更新统计
- ✅ 用户可以直接下载

### 网盘分享

适合小范围分发：
- 百度网盘
- 阿里云盘
- GitHub Artifacts

---

**打包工具版本**: PyInstaller 6.0+
**目标平台**: Windows 7/8/10/11
**Python 版本**: 3.8+
**最后更新**: 2026-01-19
