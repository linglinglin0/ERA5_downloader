# ERA5 下载器 - 打包和分发指南

## 📦 方案选择

### 方案对比

| 方案 | 优点 | 缺点 | 推荐度 |
|------|------|------|--------|
| **方案A: 源代码分发** | 简单、跨平台、文件小 | 需要Python环境 | ⭐⭐⭐⭐⭐ |
| **方案B: PyInstaller打包** | 无需Python、开箱即用 | 文件大(100MB+) | ⭐⭐⭐⭐ |
| **方案C: 在线安装器** | 自动下载依赖 | 需要网络连接 | ⭐⭐⭐ |

---

## 🎯 方案A: 源代码分发（推荐）

### 适合场景
- 分发给有Python环境的用户
- 希望文件体积小
- 需要跨平台

### 需要打包的文件

#### 核心文件（必需）
```
ERA5下载器/
├── ERA5download_GUI_v2.py          # 主程序 ✅
├── requirements.txt                 # 依赖列表 ✅
├── README.md                        # 用户说明 ✅
├── 新功能使用说明.md                # 功能文档 ✅
└── 断点续传快速使用指南.md          # 快速上手 ✅
```

#### 可选文件
```
├── ERA5download_GUI.py              # 原版程序（可选）
├── 断点续传功能说明.md              # 详细技术文档（可选）
└── docs/                            # 技术文档目录（可选）
```

#### 不需要的文件
```
❌ .era5_gui_config.json            # 配置文件（自动生成）
❌ .era5_download_progress.json     # 进度文件（自动生成）
❌ .git/                            # Git仓库
❌ __pycache__/                     # Python缓存
❌ *.pyc                            # 编译文件
❌ CLAUDE.md                        # AI文档
❌ .claude/                         # AI配置
```

### 打包步骤

#### 1. 创建发布目录
```bash
# 创建干净的发布目录
mkdir ERA5下载器-v2.1-发布版
cd ERA5下载器-v2.1-发布版
```

#### 2. 复制核心文件
```bash
# 复制主程序
copy ..\ERA5download_GUI_v2.py .

# 复制依赖文件
copy ..\requirements.txt .

# 复制文档
copy ..\README.md .
copy ..\新功能使用说明.md .
copy ..\断点续传快速使用指南.md .
```

#### 3. 创建压缩包
```bash
# Windows (使用PowerShell)
Compress-Archive -Path . -DestinationPath ERA5下载器-v2.1-源代码版.zip

# 或使用 7-Zip
7z a -tzip ERA5下载器-v2.1-源代码版.zip ERA5下载器-v2.1-发布版\
```

#### 4. 测试压缩包
```bash
# 解压到新目录测试
unzip ERA5下载器-v2.1-源代码版.zip -d test\
cd test\
pip install -r requirements.txt
python ERA5download_GUI_v2.py
```

### 分发格式

#### 文件名规范
```
ERA5下载器-v2.1-源代码版.zip
└── ERA5下载器-v2.1-发布版/
    ├── ERA5download_GUI_v2.py
    ├── requirements.txt
    ├── README.md
    ├── 新功能使用说明.md
    └── 断点续传快速使用指南.md
```

---

## 🚀 方案B: PyInstaller打包（Windows可执行文件）

### 适合场景
- 分发给没有Python环境的用户
- Windows系统
- 希望开箱即用

### 打包步骤

#### 1. 安装PyInstaller
```bash
pip install pyinstaller
```

#### 2. 创建打包脚本
创建 `build_exe.bat` 文件：
```batch
@echo off
echo ========================================
echo ERA5 下载器 - Windows可执行文件打包脚本
echo ========================================
echo.

REM 设置变量
set APP_NAME=ERA5下载器
set VERSION=v2.1
set PYTHON_PATH=python

REM 清理旧的构建
echo [1/5] 清理旧的构建文件...
if exist build rmdir /s /q build
if exist dist rmdir /s /q dist
if exist *.spec del /q *.spec

REM 使用PyInstaller打包
echo [2/5] 使用PyInstaller打包...
%PYTHON_PATH% -m PyInstaller ^
    --onefile ^
    --windowed ^
    --name "%APP_NAME%-%VERSION%" ^
    --icon=NONE ^
    --clean ^
    --noconfirm ^
    ERA5download_GUI_v2.py

if errorlevel 1 (
    echo 打包失败！
    pause
    exit /b 1
)

REM 复制文档到dist目录
echo [3/5] 复制文档文件...
copy README.md dist\
copy 新功能使用说明.md dist\
copy 断点续传快速使用指南.md dist\

REM 创建使用说明
echo [4/5] 创建使用说明...
echo ERA5 下载器 - 快速开始 > dist\开始使用.txt
echo. >> dist\开始使用.txt
echo 1. 双击 ERA5下载器-v2.1.exe 启动程序 >> dist\开始使用.txt
echo 2. 首次使用需要安装依赖（已自动包含在exe中） >> dist\开始使用.txt
echo 3. 查看 README.md 了解详细使用方法 >> dist\开始使用.txt
echo 4. 查看 新功能使用说明.md 了解新功能 >> dist\开始使用.txt
echo. >> dist\开始使用.txt
echo 技术支持: 如遇问题请查看文档 >> dist\开始使用.txt

REM 打包成ZIP
echo [5/5] 创建发布压缩包...
powershell -Command "Compress-Archive -Path dist\* -DestinationPath '%APP_NAME%-%VERSION%-Windows.zip' -Force"

echo.
echo ========================================
echo 打包完成！
echo 输出文件: %APP_NAME%-%VERSION%-Windows.zip
echo ========================================
pause
```

#### 3. 运行打包脚本
```bash
build_exe.bat
```

#### 4. 输出文件
```
ERA5下载器-v2.1-Windows.zip
└── dist/
    ├── ERA5下载器-v2.1.exe           # 主程序（约100-150MB）
    ├── README.md
    ├── 新功能使用说明.md
    ├── 断点续传快速使用指南.md
    └── 开始使用.txt
```

### PyInstaller高级选项

#### 添加图标
```bash
# 准备一个 .ico 文件
pyinstaller --onefile --windowed --icon=app.ico ERA5download_GUI_v2.py
```

#### 减小文件体积
```bash
# 使用虚拟环境打包
python -m venv venv
venv\Scripts\activate
pip install -r requirements.txt
pip install pyinstaller
pyinstaller --onefile --windowed ERA5download_GUI_v2.py
```

#### 单文件 vs 文件夹模式
```bash
# 单文件模式（推荐，便于分发）
pyinstaller --onefile --windowed ERA5download_GUI_v2.py

# 文件夹模式（启动更快）
pyinstaller --onedir --windowed ERA5download_GUI_v2.py
```

---

## 📋 完整文件清单

### 必需文件清单

```
✅ 核心程序
   ├── ERA5download_GUI_v2.py         # 主程序（626行）

✅ 依赖说明
   └── requirements.txt               # Python依赖列表

✅ 用户文档
   ├── README.md                      # 主说明文档
   ├── 新功能使用说明.md              # 新功能介绍
   └── 断点续传快速使用指南.md        # 快速上手

⚠️  配置文件（自动生成，不要打包）
   ├── .era5_gui_config.json          # 用户配置
   └── .era5_download_progress.json   # 下载进度
```

### 依赖列表 (requirements.txt)
```txt
customtkinter>=5.0.0
boto3>=1.28.0
```

---

## 📤 发布包结构

### 方案A: 源代码版（约50KB）

```
ERA5下载器-v2.1-源代码版.zip
└── ERA5下载器-v2.1/
    ├── README.md                           # 主文档
    ├── 快速开始.md                         # 快速上手
    ├── ERA5download_GUI_v2.py              # 主程序
    ├── requirements.txt                    # 依赖
    ├── 新功能使用说明.md                   # 新功能
    └── 断点续传快速使用指南.md             # 续传指南
```

**用户安装步骤**:
1. 解压压缩包
2. 安装Python 3.8+
3. 运行 `pip install -r requirements.txt`
4. 运行 `python ERA5download_GUI_v2.py`

---

### 方案B: Windows可执行版（约150MB）

```
ERA5下载器-v2.1-Windows.zip
└── ERA5下载器-v2.1/
    ├── 开始使用.txt                         # 快速开始
    ├── ERA5下载器-v2.1.exe                  # 可执行文件
    ├── README.md                            # 主文档
    ├── 新功能使用说明.md                    # 新功能
    └── 断点续传快速使用指南.md              # 续传指南
```

**用户使用步骤**:
1. 解压压缩包
2. 双击 `ERA5下载器-v2.1.exe`
3. 开始使用！

---

## 🌐 分发平台

### 推荐平台

| 平台 | 特点 | 适合 |
|------|------|------|
| **GitHub Releases** | 免费、版本管理、自动更新 | 开源项目 |
| **百度网盘** | 国内访问快 | 私人分享 |
| **坚果云** | 自动同步、免费版容量大 | 小范围分享 |
| **FTP/HTTP服务器** | 自主控制 | 企业内部 |

---

## 📝 分发检查清单

### 发布前检查

- [ ] 主程序可以正常运行
- [ ] 所有依赖都在 `requirements.txt` 中
- [ ] 文档完整（README、使用说明）
- [ ] 测试压缩包可以正常解压和使用
- [ ] 版本号和日期已更新
- [ ] 移除了所有敏感信息
- [ ] 移除了不需要的文件（缓存、配置等）
- [ ] 在干净环境中测试过安装流程

### 文档检查

- [ ] README.md 有清晰的安装说明
- [ ] 有系统要求说明（Python版本等）
- [ ] 有使用示例
- [ ] 有常见问题解答
- [ ] 有联系方式或问题反馈渠道

---

## 🎨 品牌和宣传

### 创建启动页（可选）

如果使用PyInstaller，可以添加启动画面：

```python
# 在程序启动时显示
import customtkinter as ctk

splash = ctk.CTkToplevel()
splash.geometry("400x300")
splash.title("ERA5 下载器")
ctk.CTkLabel(splash, text="ERA5 下载器", font=("微软雅黑", 24, "bold")).pack(pady=50)
ctk.CTkLabel(splash, text="v2.1 - 支持断点续传", font=("微软雅黑", 14)).pack(pady=20)
ctk.CTkLabel(splash, text="正在加载...", font=("微软雅黑", 12)).pack(pady=20)

# 加载主程序后关闭启动页
splash.destroy()
```

---

## 💡 分发建议

### 对于小范围分享（同事、同学）
1. 使用**源代码版**（文件小）
2. 通过微信/QQ/邮件发送
3. 提供简单的安装指导

### 对于公开分享
1. 使用**Windows可执行版**（无需Python）
2. 上传到GitHub Releases
3. 提供完整的文档和视频教程

### 对于企业内部
1. 提供**两种版本**（源代码 + 可执行文件）
2. 部署到内网FTP或共享目录
3. 编写企业级使用手册

---

## 🔐 安全注意事项

### 打包前清理

```bash
# 移除敏感信息
❌ 不要包含: API密钥、密码、个人信息
❌ 不要包含: 临时文件、缓存文件
❌ 不要包含: 本地配置文件
❌ 不要包含: 测试数据

✅ 应该包含: 源代码、文档、依赖列表
```

### 代码审查

1. 检查是否有硬编码的路径
2. 检查是否有调试信息（print语句）
3. 检查是否有错误处理不当的地方
4. 检查依赖项是否有安全漏洞

```bash
# 使用pip-audit检查依赖安全性
pip install pip-audit
pip-audit
```

---

## 📦 快速打包命令

### 一键打包脚本（Windows）

创建 `打包发布版.bat`:
```batch
@echo off
echo ========================================
echo ERA5 下载器 - 一键打包脚本
echo ========================================

set VERSION=v2.1
set APP_NAME=ERA5下载器

REM 创建发布目录
echo [1/3] 创建发布目录...
mkdir release 2>nul
cd release
mkdir %APP_NAME%-%VERSION% 2>nul

REM 复制文件
echo [2/3] 复制文件...
copy ..\ERA5download_GUI_v2.py %APP_NAME%-%VERSION%\
copy ..\requirements.txt %APP_NAME%-%VERSION%\
copy ..\README.md %APP_NAME%-%VERSION%\
copy ..\新功能使用说明.md %APP_NAME%-%VERSION%\
copy ..\断点续传快速使用指南.md %APP_NAME%-%VERSION%\

REM 打包
echo [3/3] 创建压缩包..
powershell -Command "Compress-Archive -Path %APP_NAME%-%VERSION% -DestinationPath %APP_NAME%-%VERSION%-源代码版.zip -Force"

echo.
echo 打包完成！
echo 输出: %APP_NAME%-%VERSION%-源代码版.zip
pause
```

---

## 📊 文件大小参考

| 版本 | 大小 | 说明 |
|------|------|------|
| 源代码版 | ~50KB | 仅代码和文档 |
| 可执行版 | ~150MB | 包含Python运行时 |
| 压缩后(源代码) | ~20KB | ZIP压缩 |
| 压缩后(可执行) | ~50MB | ZIP压缩 |

---

**版本**: v2.1
**更新**: 2026-01-19
**作者**: ERA5下载器开发组
